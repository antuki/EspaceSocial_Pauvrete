---
title: "Fiche de modélisations n°5"
subtitle : "Analyses factorielles de l'espace de la pauvreté"
author: |
    | Kim Antunez
automaticcontents: true
output:
  html_document:
    theme: cosmo
    css: style.css
    toc: true
    self_contained: true
    number_sections: true
    fig_width: 10
    fig_height: 5
    fig_caption: true
---

```{r setup, echo=FALSE, cache=FALSE}
library(knitr)
#library(rmdformats)

## Global options
#options(max.print="75")
opts_chunk$set(echo=TRUE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=FALSE,
               comment=NA,
               message=FALSE,
               warning=FALSE
               )
options(knitr.kable.NA = '')
#opts_knit$set(width=75)
```


# Objectif

L'objectif de cette cinquième série de modèles est de commencer à approcher la notion d'espace social grâce à des analyses factorielles (ACM).

# Analyses


::: {.encadre width="100%"}

L'espace social des pauvretés **monétaire**, **institutionnelle** et **subjective** des données du Baromètre se structure en deux principaux axes dont l'interprétation (délicate) pourrait être la suivante :

|       | Gauche / Bas                           | Droite / Haut                                 |
|-------|----------------------------------------|-----------------------------------------------|
| **Axe 1** | Richesse  (objective et ressentie) | Pauvreté (objective et ressentie)       |
| **Axe 2** |   Vulnérabilité vis à vis de la pauvreté / halo / risque ressenti de devenir pauvre  | Ancrage dans la richesse / pauvreté


On voit nettement que le **sentiment de pauvreté se situe à droite** et le **sentiment de risque de pauvreté se situe en bas**, arguments qui permettent de conforter un peu l'interprétation faite de ces axes.

Voir les résultats statistiques plus bas.

:::

# Code et résultats

```{r}
#chargement des packages
library(knitr)
library(dplyr) #manipuler les bases de données
library(FactoMineR) #pour les analyses factorielles
library(explor) #contient FactoMineR
```

```{r, echo=FALSE}
bdd <- readRDS("../data/2019/barometre2000_2019_diff.rds") %>% 
  filter(annee%in%2016:2019)

revenus_a_imputer <- bdd %>%
mutate(sdrevcl = ifelse(sdrevcl==999999999,NA,sdrevcl)) %>%
group_by(sdrevtr) %>% 
summarise(sdrevcl = mean(sdrevcl,na.rm=TRUE))

bdd <- bdd %>%   mutate(
    sdrevcl_imput_moy = case_when(
      sdrevcl!=999999999 ~ sdrevcl,
      sdrevcl==999999999 & sdrevtr==1 ~ revenus_a_imputer$sdrevcl[1],
      sdrevcl==999999999 & sdrevtr==2 ~ revenus_a_imputer$sdrevcl[2],
      sdrevcl==999999999 & sdrevtr==3 ~ revenus_a_imputer$sdrevcl[3],
      sdrevcl==999999999 & sdrevtr==4 ~ revenus_a_imputer$sdrevcl[4],
      sdrevcl==999999999 & sdrevtr==5 ~ revenus_a_imputer$sdrevcl[5],
      sdrevcl==999999999 & sdrevtr==6 ~ revenus_a_imputer$sdrevcl[6],
      sdrevcl==999999999 & sdrevtr==7 ~ revenus_a_imputer$sdrevcl[7]
             )
  )

bdd <- bdd %>% 
   mutate(seuil_pauvrete = do.call(c,lapply(annee,function(annee_selec){
0.6*median(bdd[bdd$annee==annee_selec,"sdrevcl_imput_moy"]/bdd[bdd$annee==annee_selec,"sduc"],
           na.rm=TRUE)
}
))) %>% 
   mutate(subj_inf_mini_decla = sdrevcl_imput_moy - ifelse(pe16==999999999,NA,pe16) <0) %>% 
  mutate(subj_pauvrete = 
           ifelse(pe3==3, TRUE,ifelse(pe3==4,NA,FALSE))) %>% 
  mutate(subj_risque_pauvrete = 
           ifelse(pe3==1, TRUE,ifelse(pe3==4,NA,FALSE))) %>% 
   mutate(subj_pauvrete_et_risque = 
           factor(
           ifelse(pe3==4, NA, ifelse(pe3==1,2,ifelse(pe3==2,1,3))),
           labels=c("Non pauvre","Risque pauvreté futur", "Déjà pauvre"))
         ) %>% 
  mutate(subj_besoin_aide_etat =
           ifelse(pe15==2, TRUE,ifelse(pe15==4,NA,FALSE))) %>%
  mutate(obj_pauvrete= sdrevcl_imput_moy/sduc<seuil_pauvrete)

bdd <- bdd %>% 
  mutate(
    prof_exercee_ou_derniere = case_when(
      sdpcs7%in%c(1,2) ~ "Agriculteurs, artisans et commerçants",
      sdpcs7%in%c(3) ~ "Cadre supérieur, profession libérale",
      sdpcs7%in%c(4) ~ "Profession intermédiaire",
      sdpcs7%in%c(5) ~ "Employé",
      sdpcs7%in%c(6) ~ "Ouvrier",
      sdpcs7%in%c(7) ~ "Autres (n'ayant jamais travaillé)"
    )
  ) %>% 
  mutate(
    activite_actuelle = case_when(
      sdsitua==4 ~ "Chômeur",
      sdsitua==6 ~ "Retraité",
      (sdsitua==1 & sdstatemp!=1) | sdsitua%in%c(2,3) ~
        "Emploi précaire/temps partiel",
      TRUE #sdsitua%in%c(5,7) | (sdsitua==1 & sdstatemp==1) incomplet
      ~
        "Autres (CDI à temps plein, étudiants en formations et personnes n'ayant jamais travaillé)"
    )
  )%>% 
  mutate(
    PCS_recode = case_when(
      prof_exercee_ou_derniere%in%c("Employé","Ouvrier") & activite_actuelle=="Emploi précaire/temps partiel" ~
        "Employés et ouvriers\nprécaires ou\ntemps partiels",
      prof_exercee_ou_derniere%in%c("Employé","Ouvrier") & activite_actuelle=="Retraité" ~
        "Employés et ouvriers\nà la retraite", #sdsitua==6
      prof_exercee_ou_derniere%in%c("Employé","Ouvrier") & activite_actuelle=="Chômeur"  ~
        "Employés et ouvriers\nau chômage",
      sdsitua==1 & !(prof_exercee_ou_derniere%in%c("Employé","Ouvrier") & activite_actuelle=="Emploi précaire/temps partiel") ~ "En emploi à temps plein",
      sdsitua%in%c(7)  ~ "Sans activité\nprofessionnelle",
      TRUE                      ~  "Autres"
    )
  ) %>% 
  mutate(
    sitfam = case_when(
      sdsitfam==2 ~ "Membre du couple",
      sdsitfam==1 ~ "Vie seule",
      sdsitfam==3 ~ "Famille monoparentale",
      sdsitfam%in%c(4,5,6,7) ~ "Autre situation (enfant de la famille,\nami ou parent hébergé, colocataire)" 
      #pas précisé si prise compte de 7 mais très peu d'individus
    )
  ) %>% 
  mutate(
    crois_pauvrete_obj_subj = case_when(
      !subj_pauvrete & !obj_pauvrete & !is.na(subj_pauvrete) & !is.na(obj_pauvrete)  ~
        "Au-dessus du seuil\net ne se sent pas pauvre",
      !subj_pauvrete & obj_pauvrete & !is.na(subj_pauvrete) & !is.na(obj_pauvrete) ~
        "Sous le seuil\nmais ne se sent pas pauvre",
      subj_pauvrete & !obj_pauvrete & !is.na(subj_pauvrete) & !is.na(obj_pauvrete) ~
        "Au-dessus du seuil\nmais se sent pauvre",
      subj_pauvrete & obj_pauvrete & !is.na(subj_pauvrete) & !is.na(obj_pauvrete)~
        "Pauvreté monétaire\net ressentie"
    )
  ) %>% 
#sdres_3 : RSA, sdres_4 : chômage, sdres_10 : handicap dépdce.
  mutate(
    assistance = case_when(
      sdres_3==1 | sdres_4==1 | sdres_10==1 ~ TRUE,
      sdres_3==2 & sdres_4==2 & sdres_10==2 ~ FALSE,
      TRUE ~ NA
      )
  ) %>% 
  mutate(
    pessimisme = case_when(
      og3_1%in%c(1,2) ~ FALSE,
      og3_1%in%c(3,4) ~ TRUE,
      og3_1%in%c(5) ~ NA
      )
  ) %>% 
  mutate(
    declassement = case_when(
      #og2_ab%in%c(1,2) | og2_cd%in%c(4,5)  ~ TRUE,
      #og2_ab%in%c(3,4,5) | og2_cd%in%c(1,2,3) ~ FALSE,
      #og2_ab%in%c(6) | og2_cd%in%c(6) ~ NA
      og2%in%c(1,2) ~ TRUE,
      og2%in%c(3,4,5) ~ FALSE,
      og2%in%c(6) ~ NA
      )
  )  %>% 
  mutate(
    proprietaire = case_when(
      lo1==1 ~ TRUE,
      lo1%in%c(2,3,4) ~ FALSE,
      lo1==5 ~ NA
      )
  ) %>% 
  mutate(
    retraite = case_when(
      sdsitua==6 ~ TRUE,
       TRUE ~ FALSE
    )
  )


```


```{r, echo=FALSE}
bdd_logit <- bdd %>% 
  mutate(quantile_nivie = factor(
    cut(sdrevcl_imput_moy/sduc, include.lowest=TRUE,
        breaks=quantile(sdrevcl_imput_moy/sduc,
                        probs=seq(0,1,0.2),na.rm=TRUE),
        labels=1:5),
    levels=c(2,1,3,4,5),
    labels=paste0("-Quintile ",c(2,1,3,4,5)))
  ) %>% 
  mutate(
    statact = factor(case_when(
      sdsitua==1 & sdstatemp%in%c(1)   ~ 1,
      sdsitua%in%c(2,3) | (sdsitua==1 & sdstatemp%in%c(NA,2,3,4,5)) ~ 2,
      sdsitua==4 ~ 3,
      sdsitua==5 ~ 4,
      sdsitua==6 ~ 5,
      sdsitua==7 ~ 6,
      TRUE ~ NA_real_
    ),
    levels=1:6,
    labels=paste0("-",
                  c("CDI temps plein",
                    "Emploi précaire ou à temps partiel",
                    "Recherche d’emploi",
                    "Étudiant",
                    "Retraité",
                    "Aucune activité professionnelle"))
    )) %>%
  # fastDummies::dummy_cols(select_columns = 'prof') %>% 
  mutate(
    diplome = factor(case_when(
      sddipl%in%c(1,2,3,4) ~ 1,
      sddipl%in%c(5,6) ~ 2,
      sddipl%in%c(7) ~ 3,
      sddipl%in%c(8) ~ 4,
      TRUE ~ NA_real_
    ),
    levels=c(2,1,3,4),
    labels=paste0("-",c("Baccalauréat","CAP, BEP ou moins","Bac + 2","Bac + 3 ou plus"))
    )) %>% 
  mutate(aide_log = factor(
    ifelse(sdres_9!=3,sdres_9,NA),
    levels=c(2,1),
    labels=paste0("-",c("Pas d'aide au logement","Aide au logement reçue"))
  )) %>% 
  mutate(aide_rsa = factor(
    ifelse(sdres_3!=3,sdres_3,NA),
    levels=c(2,1),
    labels=paste0("-",c("Pas de RSA","RSA reçu"))
  )) %>% 
  mutate(aide_handi = factor(
    ifelse(sdres_10!=3,sdres_10,NA),
    levels=c(2,1),
    labels=paste0("-",c("Pas d'alloc. hand./invalid./dépend.",
                        "Alloc. hand./invalid./dépend. reçu"))
  )) %>% 
  mutate(sexe = factor(
    ifelse(sdsexe!=3,sdsexe,NA),
    levels=c(2,1),
    labels=paste0("-",c("Femme","Homme"))
  )) %>% 
  mutate(age_tranche = factor(
    cut(sdage,
        breaks=c(18,30,40,50,60,70,120),
        include.lowest=TRUE,
        labels=1:6),
    levels=c(2,1,3,4,5,6),
    labels=paste0("-",c("30 à 39 ans","18 à 29 ans","40 à 49 ans",
                        "50 à 59 ans","60 à 69 ans", "70 ans et plus")))
  ) %>% 
  mutate(
    vie_fam = factor(case_when(
      sdsitfam==1 ~ 1,
      #sdsitfam==2 & sdnbenf==0 ~ 2,
      #sdsitfam==2 & sdnbenf!=0 ~ 3,
      sdsitfam==2 & sdnbenf==1 ~ 2,
      sdsitfam==2 & sdnbenf!=1 ~ 3,
      sdsitfam==3 ~ 4,
      sdsitfam==4 ~ 5,
      sdsitfam%in%c(5,6,7) ~ 6,
      TRUE ~ NA_real_
    ),
    levels=c(2,1,3,4,5,6),
    labels=paste0("-",
                  c("Membre du couple (pas d’enfants à charge)","Vit seul",
                    "Membre du couple (enfants à charge)", "Chef famille monoparentale",
                    "Enfant","Autre situation familiale"))
    )) %>% 
  mutate(
    statut_occup = factor(case_when(
      lo1%in%c(3,4)  ~ 1,
      lo1==2  ~ 2,
      lo1==1 ~ 3,
      lo1==5 ~ NA_real_
   ),
    levels=c(1,2,3),
    labels=paste0("-",
                  c("Locataire privé / hébergé",
                    "Locataire HLM","Propriétaire")) 
    )) %>% 
  mutate(annee_fac = factor(annee,labels=paste0("-",2016:2019))) %>% 
  mutate(annee_fac_paires = factor(ifelse(annee%in%c(2016,2018),annee,NA),labels=paste0("-",c(2016,2018)))) %>% 
  mutate(pauvrete_mon_rel= factor(
    ifelse(sdrevcl_imput_moy/sduc<seuil_pauvrete,3,
                                  ifelse(sdrevcl_imput_moy/sduc>=1.2*seuil_pauvrete,1,
                                         ifelse(sdrevcl_imput_moy/sduc<1.2*seuil_pauvrete &
                                                  sdrevcl_imput_moy/sduc>=seuil_pauvrete ,
                                                2,NA)
                                  )),
    levels=c(1,2,3),
    labels=paste0("-",c("Revenus > 20 pourcents seuil pauvreté",
                        "Entre le seuil et 20 pourcents au dessus",
                        "Pauvreté monétaire"))
  )
  )
```


```{r, echo=FALSE}
#NEW depuis fiche 3
 bdd_logit <- bdd_logit %>% #chômeur indemnise 
  mutate(
    conn_choindemnise = factor(case_when(
      sdproxim_1%in%c(1,4)  ~ 1,
      sdproxim_1%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_1==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de chômeur indemnisé",
                    "Connait un chômeur indemnisé")) 
    )) %>% 
  mutate(
    est_choindemnise = factor(case_when(
      sdproxim_1%in%c(4,6,7,8)  ~ 2,
      sdproxim_1%in%c(1,2,3,5)  ~ 1,
      sdproxim_1==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas chômeur indemnisé",
                    "est chômeur indemnisé")) 
    )) %>%
  mutate(
    conn_chononindemnise = factor(case_when(
      sdproxim_2%in%c(1,4)  ~ 1,
      sdproxim_2%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_2==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de chômeur non indemnisé",
                    "Connait un chômeur non indemnisé")) 
    )) %>% 
  mutate(
    est_chononindemnise = factor(case_when(
      sdproxim_2%in%c(4,6,7,8)  ~ 2,
      sdproxim_2%in%c(1,2,3,5)  ~ 1,
      sdproxim_2==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas chômeur non indemnisé",
                    "est chômeur non indemnisé")) 
    )) %>% #SDF
  mutate(
    conn_sdf = factor(case_when(
      sdproxim_3%in%c(1,4)  ~ 1,
      sdproxim_3%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_3==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de SDF",
                    "Connait un SDF")) 
    )) %>% 
  mutate(
    est_sdf = factor(case_when(
      sdproxim_3%in%c(4,6,7,8)  ~ 2,
      sdproxim_3%in%c(1,2,3,5)  ~ 1,
      sdproxim_3==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas SDF",
                    "est SDF")) 
    )) %>% #personne élevant seul ses enfants avec moins du SMIC 
  mutate(
    conn_eleveseulsmic = factor(case_when(
      sdproxim_4%in%c(1,4)  ~ 1,
      sdproxim_4%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_4==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de personne élevant seul ses enfants avec moins du SMIC",
                    "Connait une personne élevant seul ses enfants avec moins du SMIC")) 
    )) %>% 
  mutate(
    est_eleveseulsmic = factor(case_when(
      sdproxim_4%in%c(4,6,7,8)  ~ 2,
      sdproxim_4%in%c(1,2,3,5)  ~ 1,
      sdproxim_4==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas personne élevant seul ses enfants avec moins du SMIC",
                    "est personne élevant seul ses enfants avec moins du SMIC")) 
    )) %>% #pensionné invalide indicapé ne pouvant pas travailler 
  mutate(
    conn_pensionhandi = factor(case_when(
      sdproxim_5%in%c(1,4)  ~ 1,
      sdproxim_5%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_5==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de pensionné invalide indicapé ne pouvant pas travailler",
                    "Connait un pensionné invalide indicapé ne pouvant pas travailler")) 
    )) %>% 
  mutate(
    est_pensionhandi = factor(case_when(
      sdproxim_5%in%c(4,6,7,8)  ~ 2,
      sdproxim_5%in%c(1,2,3,5)  ~ 1,
      sdproxim_5==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas pensionné invalide indicapé ne pouvant pas travailler",
                    "est pensionné invalide indicapé ne pouvant pas travailler")) 
    )) %>% #personne en emploi précaire 
  mutate(
    conn_emploiprecaire = factor(case_when(
      sdproxim_6%in%c(1,4)  ~ 1,
      sdproxim_6%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_6==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de personne en emploi précaire",
                    "Connait une personne en emploi précaire")) 
    )) %>% 
  mutate(
    est_emploiprecaire = factor(case_when(
      sdproxim_6%in%c(4,6,7,8)  ~ 2,
      sdproxim_6%in%c(1,2,3,5)  ~ 1,
      sdproxim_6==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas personne en emploi précaire",
                    "est personne en emploi précaire")) 
    )) %>% #personne au RSA 
  mutate(
    conn_rsa = factor(case_when(
      sdproxim_7%in%c(1,4)  ~ 1,
      sdproxim_7%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_7==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de personne au RSA",
                    "Connait une personne au RSA")) 
    )) %>% 
  mutate(
    est_rsa = factor(case_when(
      sdproxim_7%in%c(4,6,7,8)  ~ 2,
      sdproxim_7%in%c(1,2,3,5)  ~ 1,
      sdproxim_7==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas personne au RSA",
                    "est personne au RSA")) 
    )) %>% #personne handicapée de moins de 60 ans
  mutate(
    conn_handijeune = factor(case_when(
      sdproxim_8%in%c(1,4)  ~ 1,
      sdproxim_8%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_8==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de personne handicapée de moins de 60 ans",
                    "Connait une personne handicapée de moins de 60 ans")) 
    )) %>% 
  mutate(
    est_handijeune = factor(case_when(
      sdproxim_8%in%c(4,6,7,8)  ~ 2,
      sdproxim_8%in%c(1,2,3,5)  ~ 1,
      sdproxim_8==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas personne handicapée de moins de 60 ans",
                    "est personne handicapée de moins de 60 ans")) 
    )) %>% #personne âgée dépendante
  mutate(
    conn_dependant = factor(case_when(
      sdproxim_9%in%c(1,4)  ~ 1,
      sdproxim_9%in%c(2,3,5,6,7,8)  ~ 2,
      sdproxim_9==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Ne connaît pas de personne âgée dépendante",
                    "Connait une personne âgée dépendante")) 
    )) %>% 
  mutate(
    est_dependant = factor(case_when(
      sdproxim_9%in%c(4,6,7,8)  ~ 2,
      sdproxim_9%in%c(1,2,3,5)  ~ 1,
      sdproxim_9==9 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("N'est pas personne âgée dépendante",
                    "est personne âgée dépendante")) 
    )) %>% 
  mutate(
    revenus_salaires = factor(case_when(
      sdres_1%in%c(2)  ~ 1,
      sdres_1%in%c(1)  ~ 2,
      sdres_1==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de revenus de salaires",
                    "Revenus de salaires")) 
    )) %>% 
  mutate(
    revenus_independant = factor(case_when(
      sdres_2%in%c(2)  ~ 1,
      sdres_2%in%c(1)  ~ 2,
      sdres_2==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de revenus d'activité indépendante",
                    "Revenus d'activité indépendante")) 
    )) %>%  
  mutate(
    presta_rsa = factor(case_when(
      sdres_3%in%c(2)  ~ 1,
      sdres_3%in%c(1)  ~ 2,
      sdres_3==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de RSA",
                    "RSA")) 
    )) %>% 
  mutate(
    presta_chomage = factor(case_when(
      sdres_4%in%c(2)  ~ 1,
      sdres_4%in%c(1)  ~ 2,
      sdres_4==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas d'allocation chômage",
                    "Allocation chômage")) 
    )) %>% 
  mutate(
    revenus_retraite = factor(case_when(
      sdres_5%in%c(2)  ~ 1,
      sdres_5%in%c(1)  ~ 2,
      sdres_5==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de revenus de retraite",
                    "Revenus de retraite")) 
    )) %>%
  mutate(
    revenus_financiers = factor(case_when(
      sdres_6%in%c(2)  ~ 1,
      sdres_6%in%c(1)  ~ 2,
      sdres_6==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de revenus d'actifs financiers",
                    "Revenus d'actifs financiers")) 
    )) %>% 
  mutate(
    revenus_locatifs = factor(case_when(
      sdres_7%in%c(2)  ~ 1,
      sdres_7%in%c(1)  ~ 2,
      sdres_7==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de revenus de locations",
                    "Revenus de locations")) 
    )) %>% 
  mutate(
    presta_fam = factor(case_when(
      sdres_8%in%c(2)  ~ 1,
      sdres_8%in%c(1)  ~ 2,
      sdres_8==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de prestations familiales",
                    "Prestations familiales")) 
    )) %>% 
  mutate(
    presta_apl = factor(case_when(
      sdres_9%in%c(2)  ~ 1,
      sdres_9%in%c(1)  ~ 2,
      sdres_9==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas d'APL",
                    "APL")) 
    )) %>% 
  mutate(
    presta_handi = factor(case_when(
      sdres_10%in%c(2)  ~ 1,
      sdres_10%in%c(1)  ~ 2,
      sdres_10==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas d'AAH, APA, PCH (handicap)",
                    "AAH, APA, PCH (handicap)")) 
    )) %>% 
  mutate(
    presta_etudes = factor(case_when(
      sdres_11%in%c(2)  ~ 1,
      sdres_11%in%c(1)  ~ 2,
      sdres_11==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de bourse d'étude",
                    "bourse d'étude")) 
    )) %>% 
  mutate(
    presta_pensionalim = factor(case_when(
      sdres_12%in%c(2)  ~ 1,
      sdres_12%in%c(1)  ~ 2,
      sdres_12==3 ~ NA_real_
   ),
    levels=c(1,2),
    labels=paste0("-",
                  c("Pas de pension alimentaire",
                    "pension alimentaire")) 
    )) %>% 
  mutate(
    statut_activite = factor(case_when(
      sdstat==2 & (sdsitua==1 & sdstatemp==1) ~ 1,
      sdstat==2 & !(sdsitua==1 & sdstatemp==1) ~ 2,
      sdstat==1 & (sdsitua==1 & sdstatemp==1) ~ 3,
      sdstat==1 & !(sdsitua==1 & sdstatemp==1) ~ 4,
      sdstat==3 ~ 5,
      sdstat==4 ~ 6,
      sdstat==5 ~ 7,
      sdstat==6 ~ 8,
      sdstat==7 ~ 9,
      sdstat==8 ~ NA_real_
   ),
    levels=1:9,
    labels=paste0("-",
                  c("Salarié du secteur privé (en CDI à temps plein)",
"Salarié du secteur privé (précaire ou à temps partiel)",
"Salarié du secteur public (en CDI à temps plein)",
"Salarié du secteur public (précaire ou à temps partiel)",
"Indépendant sans salarié",
"Employeur",
"Chômeur",
"Inactif",
"Autre statut d'activité")
) 
    )) %>% 
  mutate(prof = factor(
    sdpcs7,
    levels=c(4,1,2,3,5,6,7),
    labels=paste0("-",c("Profession intermédiaire","Agriculteur",
                        "Artisan commerçant","Cadre supérieur, profession libérale",
                        "Employé","Ouvrier","Autre inactif"))
  ))  %>% 
  mutate(prof_statut_act = factor(
    sdpcs10,
    levels=c(4,1,2,3,5,6,7,8,9,10),
    labels=paste0("-",c("Profession intermédiaire","Agriculteur",
                        "Artisan commerçant","Cadre supérieur, profession libérale",
                        "Employé","Ouvrier","Chômeur",
                        "Retraité","Au foyer","Autre inactif"))
  )) %>%
  mutate(
    statut_activite_resp = factor(case_when(
      sdprstat==2 & (sdprsitua==1) ~ 1,
      sdprstat==2 & !(sdprsitua==1) ~ 2,
      sdprstat==1 & (sdprsitua==1) ~ 3,
      sdprstat==1 & !(sdprsitua==1) ~ 4,
      sdprstat==3 ~ 5,
      sdprstat==4 ~ 6,
      sdprstat==5 ~ 7,
      sdprstat==6 ~ 8,
      sdprstat==7 ~ 9,
      sdprstat==8 ~ NA_real_
   ),
    levels=1:9,
    labels=paste0("-Pers. réf. ",
                  c("Salarié du secteur privé (à temps plein)",
"Salarié du secteur privé (à temps partiel)",
"Salarié du secteur public (à temps plein)",
"Salarié du secteur public (à temps partiel)",
"Indépendant sans salarié",
"Employeur",
"Chômeur",
"Inactif",
"Autre statut d'activité")
) 
    )) %>% 
  mutate(prof_resp = factor(
    sdprpcs7,
    levels=c(4,1,2,3,5,6,7),
    labels=paste0("-Pers. réf. ",c("Profession intermédiaire","Agriculteur",
                        "Artisan commerçant","Cadre supérieur, profession libérale",
                        "Employé","Ouvrier","Autre inactif"))
  )) %>% 
  mutate(prof_statut_act_resp = factor(
    sdprpcs10,
    levels=c(4,1,2,3,5,6,7,8,9,10),
    labels=paste0("-Pers. réf. ",c("Profession intermédiaire","Agriculteur",
                        "Artisan commerçant","Cadre supérieur, profession libérale",
                        "Employé","Ouvrier","Chômeur",
                        "Retraité","Au foyer","Autre inactif"))
  ))

```


```{r, echo=FALSE}
afficher_tableau <- function(tab){
  
  options <- list(lengthMenu = c(10,20,50,100),
                        pageLength = 20, orderClasses = TRUE,
                        autoWidth = FALSE, searching = TRUE)
  
  order_option <- function(table, name, order="desc") {
    index <- which(names(table) == name) - 1
    list(order = list(list(index, order)))
  }
  
  dt <- DT::datatable(tab,
                      options = c(options, order_option(tab, "Coord")),
                      rownames = FALSE)
  indices_3 <- which(names(tab) %in% c("Coord", "Cos2", "V.test", "eta2", "P.value"))
  indices_2 <- which(names(tab) %in% c("Contrib"))
  if (length(indices_3) > 0) {
    dt <- dt %>%
      DT::formatRound(indices_3, digits = 3)
  }
  if (length(indices_2) > 0) {
    dt <- dt %>%
      DT::formatRound(indices_2, digits = 2)
  }
  return(dt)
}
```



## Pauvreté monétaire, institutionnelle et subjective **[NEW]**

### Variables actives

```{r}
actives_autres <- c("quantile_nivie", "presta_rsa","presta_chomage","presta_apl")
actives_subj <- c("subj_pauvrete_et_risque", "subj_inf_mini_decla")
actives <- c(actives_subj,actives_autres)
passives <- c("revenus_financiers","revenus_locatifs","presta_handi","statut_occup", "diplome", "conn_rsa","annee_fac", "prof_statut_act", "age_tranche","vie_fam")

bdd_acm <- bdd_logit %>% 
  select(c(all_of(actives),all_of(passives))) %>% 
  tidyr::drop_na()
res.mca <- MCA(bdd_acm,quali.sup=(length(actives)+1):(ncol(bdd_acm)),
               graph=FALSE) 
#explor(res.mca)
res <- explor::prepare_results(res.mca)

```

Les trois premiers axes de l'ACM (qui conservent respectivement 24,7, 12,4 et 10,8 % de l'inertie) sont les suivants. Le saut d'inertie entre les axes 2 et 3 est faible et les résultats de l'axe 3 nous invitent à **structurer l'espace uniquement selon les deux premières dimensions**.

- Le **premier axe** (horizontal figure 1) oppose clairement à droite les personnes pauvres monétairement (premier quintile de niveau de vie), institutionnellement (RSA en particulier et APL et allocation chômage dans une moins mesure) et subjectivement (sentiment de pauvreté et revenu inférieur au minimum déclaré) et à gauche les personnes plus riches (Q5,Q4, non pauvre, non inférieur au minimum déclaré, et dans une moindre mesure n'étant pas bénéficiaires de prestations sociales).

- Le **deuxième axe** (vertical) est assez original à interpréter. Avec les Q1 et Q5 qui sont au même niveau en haut et s'opposent aux Q2 et Q3 en bas. Une interprétation probable est que cet axe semble opposer les personnes très riches (Q5) ou très pauvre (Q1, RSA, sentiment de pauvreté) en haut de l'axe à des personnes légèrement moins pauvres mais vulnérables, pouvant basculer dans la pauvreté en bas (Q2, Q3, risque ressenti de pauvreté dans 5 ans, au chômage).

- [*Le troisième axe (horizontal figure 2) ne se structure que par rapport aux quintiles de niveau de vie mais oppose Q2 + Q5 (à droite) à Q3 + Q4 (à gauche). Son interprétation en est rendu difficile et brouillerait le message des deux premiers axes.*]

```{r}
xlim <- c(-1.61, 2.74)
ylim <- c(-2.28, 2.07)
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = NULL,
    var_lab_min_contrib = 0, col_var = "Variable", symbol_var = "Type", size_var = NULL,
    size_range = c(10, 300), labels_size = 10, point_size = 56, transitions = TRUE,
    labels_positions = NULL, labels_prepend_var = FALSE, xlim = xlim,
    ylim = ylim)

explor::MCA_var_plot(res, xax = 3, yax = 2, var_sup = TRUE, var_sup_choice = NULL,
    var_lab_min_contrib = 0, col_var = "Variable", symbol_var = "Type", size_var = NULL,
    size_range = c(10, 300), labels_size = 10, point_size = 56, transitions = TRUE,
    labels_positions = NULL, labels_prepend_var = FALSE, xlim = xlim,
    ylim = ylim)

```

Axe 1

```{r, echo=FALSE}
res$vars %>% 
  filter(Type == "Active", Axis == 1) %>% 
  select(Variable,Level,Count,Coord,Contrib,Cos2) %>% 
  data.frame() %>% 
  afficher_tableau()
```

Axe 2

```{r, echo=FALSE}
res$vars %>% 
  filter(Type == "Active", Axis == 2) %>% 
  select(Variable,Level,Count,Coord,Contrib,Cos2) %>% 
  data.frame() %>% 
  afficher_tableau()
```

Axe 3

```{r, echo=FALSE}
res$vars %>% 
  filter(Type == "Active", Axis == 3) %>% 
  select(Variable,Level,Count,Coord,Contrib,Cos2) %>% 
  data.frame() %>% 
  afficher_tableau()
```


Ci-dessous quelques nuages des +11 000 individus colorés selon certaines variables catégorielles actives. On voit sur ce nuage uniquement quelques centaines d'individus car nombre d'entre eux se ressemblent selon les variables actives (peu de variables et donc souvent mêmes modalités répondues). 

- Pour les quintiles de niveau de vie, rien de plus à ajouter que ce qui a été dit au-dessus, avec un positionnement en "cuvette" permettant de distinguer les deux dimensions de pauvreté et vulnérabilité potentielle
- Pour le RSA, l'opposition se fait entre droite et gauche de l'ACM (pauvreté versus richesse). 
- Même remarque pour les APL, avec une distinction moins nette que pour le RSA. 
- Pour les allocations chômage, l'opposition est davantage entre haut et bas de l'ACM (vulnérabilité potentielle versus situation de richesse / pauvreté ancrée).
- L'indicateur `subj_pauvrete_et_risque` qui rassemble sentiment de pauvreté (indiquer se sentir pauvre, à droite) et risque de pauvreté (indiquer ne pas se sentir pauvre mais penser risquer l'être dans les 5 prochaines années, en bas) a un positionnement en triangle qui illustre l'importance fondamentale que cette variable a dans la constitutions des deux axes
- L'indicateur du niveau de vie inférieur à un niveau de vie minimum pour vivre déclaré se différencie selon les deux aspects et fait probablement la synthèse / l'entre-deux entre les modalités de l'indicateur précédent. 


```{r, echo=FALSE}
explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "quantile_nivie", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = xlim, ylim = ylim)

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "presta_rsa", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = xlim, ylim = ylim)

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "presta_apl", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = xlim, ylim = ylim)

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "presta_chomage", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = xlim, ylim = ylim)


explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "subj_pauvrete_et_risque", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = xlim, ylim = ylim)


explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "subj_inf_mini_decla", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = xlim, ylim = ylim)

 
```


### Variables supplémentaires

Axe 1

```{r, echo=FALSE}
res$vars %>% 
  filter(grepl("Supplementary", Type), Axis == 1) %>%
  mutate(Level = ifelse(Class == "Quantitative", "-", Level)) %>% 
  select(Variable, Level, Count,Coord,Contrib,Cos2,V.test,P.value) %>% 
  data.frame %>% 
  afficher_tableau()
```

Axe 2

```{r, echo=FALSE}
res$vars %>% 
  filter(grepl("Supplementary", Type), Axis == 2) %>%
  mutate(Level = ifelse(Class == "Quantitative", "-", Level)) %>% 
  select(Variable, Level, Count,Coord,Contrib,Cos2,V.test,P.value) %>% 
  data.frame %>% 
  afficher_tableau()
```

Axe 3

```{r, echo=FALSE}
res$vars %>% 
  filter(grepl("Supplementary", Type), Axis == 3) %>%
  mutate(Level = ifelse(Class == "Quantitative", "-", Level)) %>% 
  select(Variable, Level, Count,Coord,Contrib,Cos2,V.test,P.value) %>% 
  data.frame %>% 
  afficher_tableau()
```




#### Autres indicateurs de pauvreté monétaire

(ou plutôt richesse comme il s'agit des revenus financiers et locatifs).

Quand on les met en variables actives, elles déterminent un axe à elles seules de par leur spécificité. Je les ai donc gardées en supplémentaires. 

En supplémentaires, ces deux variables se rapprochent de Q5 et Q4. En revanche, l'absence de revenus de location et financier se rapproche du centre de l'ACP. C'est assez logique dans le sens ou ces types de revenus concernent des personnes fortunées.

```{r, echo=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("revenus_financiers",
                                                                               "revenus_locatifs"), var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable",
                     size_var = NULL, size_range = c(10, 300), labels_size = 10, point_size = 128,
                     transitions = TRUE, labels_positions = "auto", labels_prepend_var = FALSE,
                     xlim = xlim, ylim = ylim)
```


#### Professions et statuts d'emploi

Les professions et statuts d'emploi ont des positions assez marquées sur les axes de l'ACM comparées aux autres variables en supplémentaire. 

- Les cadres supérieurs et professions libérales sont en haut à gauche (ancrage dans la richesse)
- Les chômeurs, personnes au foyer et autres inactifs sont situé à droite au milieu (pauvreté). 
- Les ouvriers et employés sont situés en bas au milieu (vulnérabilité potentielle).


```{r, echo=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = "prof_statut_act",
                     var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable", size_var = NULL,
                     size_range = c(10, 300), labels_size = 10, point_size = 128, transitions = TRUE,
                     labels_positions = "auto", labels_prepend_var = FALSE, 
                     xlim = xlim, ylim = ylim)
```

#### Vie familiale et tranche d'âge

Vie familiale et tranche d'âge se positionnent selon la même logique, en particulier selon l'axe horizontal. 

- Les couples sans enfant sont en légèrement en haut et à gauche (relatif ancrage dans la richesse)
- Les personnes âgées sont situées à relativement à gauche au milieu (richesse relative) alors que les enfants et jeunes sont situés à droite au milieu (pauvreté relative)
- Les chefs de famille monoparentale sont situés à gauche et plutôt en haut (ancrage dans la pauvreté)
- Les couples avec enfant en haut au milieu (richesse moyenne et peu vulnérable par rapport à la pauvreté). 

```{r, echo=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("age_tranche",
                                                                               "vie_fam"), var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable",
                     size_var = NULL, size_range = c(10, 300), labels_size = 10, point_size = 128,
                     transitions = TRUE, labels_positions = NULL, labels_prepend_var = FALSE, 
                     xlim = xlim, ylim = ylim)
```

#### Autres variables qui se démarquent peu

Ce dernier graphique présente les dernières modalités, qui se démarquent peu sur cette ACM. Le graphique a d'ailleurs été zoomé car tout s'agglutinait au centre des deux axes. Quelques variables particulières à noter cependant : 

- Les diplômés de bac+3 et plus sont plutôt en haut à gauche (ancrage dans la richesse)
- Les diplômés de bac+2 et propriétaires plutôt à gauche au milieu (richesse)
- Les personnes qui touchent les allocations liées aux handicap sont plutôt en bas à droite (pauvreté et vulnérabilité)
- Les personnes locataires, surtout de HLM sont situés à droite au milieu (pauvreté sans vulnérabilité/ancrage particulier)
- Les personnes peu diplômées (CAP/BEP ou moins) sont situées en bas et légèrement à droite (légère pauvreté et vulnérabilité)

```{r, echo=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("presta_handi",
                                                                               "statut_occup", "diplome", "conn_rsa", "annee_fac"), var_lab_min_contrib = 0,
                     col_var = "Type", symbol_var = "Variable", size_var = NULL, size_range = c(10,
                                                                                                300), labels_size = 10, point_size = 128, transitions = TRUE, labels_positions = NULL,
                     labels_prepend_var = FALSE,
                     xlim = xlim, ylim = ylim)

```


## Pauvreté monétaire et institutionnelle **[ANCIENNE DEMARCHE]**

### Variables actives

```{r}
actives <- c("quantile_nivie", "presta_rsa","presta_chomage","presta_apl")
passives_autres <- c("revenus_financiers","revenus_locatifs","presta_handi","statut_occup", "diplome", "conn_rsa","annee_fac", "prof_statut_act", "age_tranche","vie_fam")
passives_subj <- c("subj_pauvrete","subj_risque_pauvrete", "subj_inf_mini_decla")
passives <- c(passives_subj,passives_autres)

bdd_acm <- bdd_logit %>% 
  select(c(all_of(actives),all_of(passives))) %>% 
  tidyr::drop_na()
res.mca <- MCA(bdd_acm,quali.sup=(length(actives)+1):(ncol(bdd_acm)),
               graph=FALSE) 

res <- explor::prepare_results(res.mca)
```

Les deux premiers axes de l'ACM (qui conservent respectivement 26 et 15 % de l'inertie) sont les suivants. 

- Le **premier axe** (horizontal) oppose clairement à droite les personnes pauvres monétairement (premier quintile de niveau de vie) et institutionnellement (RSA en particulier et APL et allocation chômage dans une moins mesure) et à gauche les personnes plus riches (Q3, Q4 et Q5, n'étant pas bénéficiaires de prestations sociales).

- Le **deuxième axe** (vertical) apparaît plus difficile à interpréter. Avec les Q1 et Q5 qui sont au même niveau en bas et s'opposent au Q2. Une interprétation possible est que cet axe semble opposer les personnes très riches (Q5,Q4) ou très pauvre (Q1, RSA) en bas de l'axe à des personnes légèrement moins pauvres mais vulnérables, pouvant basculer dans la pauvreté en haut (Q2, au chômage).


```{r}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = NULL,
                     var_lab_min_contrib = 0, col_var = "Variable", symbol_var = "Type", size_var = NULL,
                     size_range = c(10, 300), labels_size = 10, point_size = 128, transitions = TRUE,
                     labels_positions = "auto", labels_prepend_var = FALSE, xlim = c(-1.42, 3.24),
                     ylim = c(-2.26, 2.41))
```

<!-- Axe 1 -->

```{r, echo=FALSE, eval = FALSE}
res$vars %>% 
  filter(Type == "Active", Axis == 1) %>% 
  select(Variable,Level,Count,Coord,Contrib,Cos2) %>% 
  data.frame() %>% 
  afficher_tableau()
```

<!-- Axe 2 -->

```{r, echo=FALSE, eval = FALSE}
res$vars %>% 
  filter(Type == "Active", Axis == 2) %>% 
  select(Variable,Level,Count,Coord,Contrib,Cos2) %>% 
  data.frame() %>% 
  afficher_tableau()
```

Ci-dessous quelques nuages des +11 000 individus colorés selon certaines variables catégorielles actives. On voit sur ce nuage uniquement une cinquantaine d'individus car nombre d'entre eux se ressemblent selon les variables actives (peu de variables et donc souvent mêmes modalités répondues). 

- Pour les quintiles de niveau de vie, rien de plus à ajouter que ce qui a été dit au-dessus.
- Pour le RSA, l'opposition se fait entre droite et gauche de l'ACM (richesse versus pauvreté). 
- Même remarque pour les APL, avec une distinction moins nette que pour le RSA. 
- Pour les allocations chômage, l'opposition est davantage entre haut et bas de l'ACM (vulnérabilité potentielle versus situation de richesse / pauvreté ancrée).


```{r, echo=FALSE, eval=FALSE}

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "quantile_nivie", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "presta_rsa", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "presta_apl", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "presta_chomage", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))


```


### Variables supplémentaires

<!-- Axe 1 -->

```{r, echo=FALSE, eval=FALSE}
res$vars %>% 
  filter(grepl("Supplementary", Type), Axis == 1) %>%
  mutate(Level = ifelse(Class == "Quantitative", "-", Level)) %>% 
  select(Variable, Level, Count,Coord,Contrib,Cos2,V.test,P.value) %>% 
  data.frame %>% 
  afficher_tableau()
```

<!-- Axe 2 -->

```{r, echo=FALSE,eval=FALSE}
res$vars %>% 
  filter(grepl("Supplementary", Type), Axis == 2) %>%
  mutate(Level = ifelse(Class == "Quantitative", "-", Level)) %>% 
  select(Variable, Level, Count,Coord,Contrib,Cos2,V.test,P.value) %>% 
  data.frame %>% 
  afficher_tableau()
```

#### Pauvreté subjective

Quand on regarde le nuage des individus, on se rend compte que l'interprétation de ces différentes variables de pauvreté sujective projetées en supplémentaires est délicate (ellipses se superposent beaucoup, en particulier pour les deux derniers). Mais s'il fallait interpréter leur centroïde uniquement, nous dirions quelque chose comme ce qui suit...

- L'indicateur de sentiment de pauvreté (indiquer se sentir pauvre) se situe au long du premier axe de l'ACP et sépare bien les personnes pauvres à droite des personnes riches à gauche. 
- L'indicateur de risque de pauvreté (indiquer ne pas se sentir pauvre mais penser risquer l'être dans les 5 prochaines années) se situe davantage sur l'axe vertical. Ce résultat est cohérent avec l'interprétation selon laquelle le deuxième axe de l'ACM fait référence à une situation de vulnérabilité potentielle vis à vis de la pauvreté. 
- L'indicateur du niveau de vie inférieur à un niveau de vie minimum pour vivre déclaré se différencie selon les deux aspects et fait probablement la synthèse / l'entre-deux entre les deux indicateurs précédents. 

```{r, echo=FALSE, eval=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("subj_pauvrete",
                                                                               "subj_risque_pauvrete", "subj_inf_mini_decla"), var_lab_min_contrib = 0,
                     col_var = "Type", symbol_var = "Variable", size_var = NULL, size_range = c(10,
                                                                                                300), labels_size = 10, point_size = 128, transitions = TRUE, labels_positions = "auto",
                     labels_prepend_var = FALSE, xlim = c(-1.42, 3.24), ylim = c(-2.26, 2.41))

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "subj_pauvrete", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))

explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "subj_risque_pauvrete", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))


explor::MCA_ind_plot(res, xax = 1, yax = 2, ind_sup = FALSE, lab_var = NULL,
                     ind_lab_min_contrib = 0, col_var = "subj_inf_mini_decla", labels_size = 9, point_opacity = 1,
                     opacity_var = NULL, point_size = 33, ellipses = TRUE, transitions = FALSE,
                     labels_positions = NULL, xlim = c(-1.13, 2.9), ylim = c(-1.89, 2.15))

```

#### Autres indicateurs de pauvreté monétaire

(ou plutôt richesse comme il s'agit des revenus financiers et locatifs).

Quand on les met en variables actives, elles déterminent un axe à elles seules de par leur spécificité. Je les ai donc gardées en supplémentaires. 

En supplémentaires, ces deux variables se rapprochent de Q5. En revanche, l'absence de revenus de location et financier se rapproche du centre de l'ACP. C'est assez logique dans le sens ou ces types de revenus concernent des personnes fortunées.

```{r, echo=FALSE, eval = FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("revenus_financiers",
                                                                               "revenus_locatifs"), var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable",
                     size_var = NULL, size_range = c(10, 300), labels_size = 10, point_size = 128,
                     transitions = TRUE, labels_positions = "auto", labels_prepend_var = FALSE,
                     xlim = c(-1.42, 3.24), ylim = c(-2.26, 2.41))
```


#### Professions et statuts d'emploi

Les professions et statuts d'emploi ont des positions assez marquées sur les axes de l'ACM comparées aux autres variables en supplémentaire. 

- Les chômeurs sont situés à la fois à droite et en haut (pauvreté et vulnérabilité) alors que les cadres supérieurs et professions libérales sont en bas à gauche (ancrage dans la richesse)
- Les personnes au foyer et autres inactifs sont situé à droite au milieu (pauvreté). 
- Les ouvriers et employés sont situés en haut au milieu (vulnérabilité potentielle).

```{r, echo=FALSE, eval=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = "prof_statut_act",
                     var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable", size_var = NULL,
                     size_range = c(10, 300), labels_size = 10, point_size = 128, transitions = TRUE,
                     labels_positions = "auto", labels_prepend_var = FALSE, xlim = c(-1.42, 3.24),
                     ylim = c(-2.26, 2.41))
```

#### Vie familiale et tranche d'âge

Vie familiale et tranche d'âge se positionnent selon la même logique, en particulier selon l'axe horizontal. 

- Les couples sans enfant sont en bas à gauche (ancrage dans la richesse)
- Les personnes âgées sont situées à relativement à gauche et au milieu (richesse relative) alors que les enfants sont situés à droite au milieu (pauvreté)
- Les chefs de famille monoparentale sont situés à gauche et plutôt en bas (ancrage dans la pauvreté)
- Les couples avec enfant en bas au milieu (richesse moyenne et peu vulnérable par rapport à la pauvreté). 
- Les jeunes de 18 à 29 ans sont plutôt vers le haut (vulnérabilité potentielle)

```{r, echo=FALSE, eval=FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("age_tranche",
                                                                               "vie_fam"), var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable",
                     size_var = NULL, size_range = c(10, 300), labels_size = 10, point_size = 128,
                     transitions = TRUE, labels_positions = NULL, labels_prepend_var = FALSE, xlim = c(-1.42, 3.24),
                     ylim = c(-2.26, 2.41)
                     ) #xlim = c(-0.944, 1.47), ylim = c(-1.32, 1.1)
```

#### Autres variables qui se démarquent peu

Ce dernier graphique présente les dernières modalités, qui se démarquent peu sur cette ACM. Le graphique a d'ailleurs été zoomé car tout s'agglutinait au centre des deux axes. Quelques variables particulières à noter cependant : 

- Les diplômés de bac+3 et plus et les propriétaires sont plutôt en bas à gauche (ancrage dans la richesse)
- Les personnes qui touchent les allocations liées aux handicap sont plutôt en haut à droite (pauvreté et vulnérabilité)
- Les personnes locataires sont situés relativement à droite et au légèrement en haut (pauvreté et légère vulnérabilité)
- Les personnes peu diplômées (CAP/BEP ou moins) sont situées en haut et légèrement à droite (légère pauvreté et vulnérabilité)

```{r, echo=FALSE, eval = FALSE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = c("presta_handi",
                                                                               "statut_occup", "diplome", "conn_rsa", "annee_fac"), var_lab_min_contrib = 0,
                     col_var = "Type", symbol_var = "Variable", size_var = NULL, size_range = c(10,
                                                                                                300), labels_size = 10, point_size = 128, transitions = TRUE, labels_positions = NULL,
                     labels_prepend_var = FALSE, xlim = c(-0.527, 0.525), ylim = c(-0.579, 0.474))

```

Bilan 

```{r, echo=FALSE, eval=TRUE}
explor::MCA_var_plot(res, xax = 1, yax = 2, var_sup = TRUE, var_sup_choice = passives, var_lab_min_contrib = 0, col_var = "Type", symbol_var = "Variable",
                     size_var = NULL, size_range = c(10, 300), labels_size = 10, point_size = 128,
                     transitions = TRUE, labels_positions = NULL, labels_prepend_var = FALSE, xlim = c(-1.42, 3.24),
                     ylim = c(-2.26, 2.41)
                     )
```

# Notes méthodologiques

Pour ces modèles quatre vagues du Baromètre ont été empilées : 2016, 2017, 2018 et 2019 (12 114 observations) mais seules 10 555 observations sont conservées (celles qui n'ont aucune variable manquante pour l'ensemble des variables utilisées, actives comme supplémentaires).

# Bibliographie {.unnumbered}

- https://quanti.hypotheses.org/1871